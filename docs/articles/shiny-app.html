<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shiny App â€¢ googleComputeEngineR</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">googleComputeEngineR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/installation-and-authentication.html">Setup</a>
</li>
<li>
  <a href="../articles/creating-vms.html">Creating VMs</a>
</li>
<li>
  <a href="../articles/docker-ssh-futures.html">SSH &amp; Docker</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example-workflows.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/rstudio-team.html">Custom team RStudio Server</a>
    </li>
    <li>
      <a href="../articles/single-scheduler.html">RStudio Server + scheduler</a>
    </li>
    <li>
      <a href="../articles/shiny-app.html">Shiny App</a>
    </li>
    <li>
      <a href="../articles/opencpu-api-server.html">OpenCPU R API</a>
    </li>
    <li>
      <a href="../articles/scheduled-rscripts.html">Scheduled cron master/slave</a>
    </li>
    <li>
      <a href="../articles/massive-parallel.html">Massive parallel computing</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Help
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../reference/index.html">Reference</a>
    </li>
    <li>
      <a href="../news/index.html">News</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://cloud.google.com/compute/">Google Compute Engine</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Shiny App</h1>
                        <h4 class="author">Mark Edmondson</h4>
            
            <h4 class="date">2017-06-18</h4>
          </div>

    
    
<div class="contents">
<div id="self-contained-shiny-app" class="section level1">
<h1 class="hasAnchor">
<a href="#self-contained-shiny-app" class="anchor"></a>Self-contained Shiny app</h1>
<p>This creates a dedicated Docker container that has all the libraries, files and scripts necessary to run your Shiny app. This example uses a local <code>Dockerfile</code> to install the libraries you need, but in addition also copies your Shiny app scripts so its all self-contained and portable.</p>
<p>The Shiny app can then be deployed on new instances.</p>
<p>In summary:</p>
<ol style="list-style-type: decimal">
<li>Create a Dockerfile including copying the Shiny app into the Docker image</li>
<li>Use build triggers or <code>docker_build</code> to create and push your Shiny image to Google container registry</li>
<li>Start up a Shiny templated Google Compute Engine VM calling your custom Shiny image</li>
<li>Enjoy your Shiny app</li>
</ol>
<p>Once built, you can deploy straight from the Container Registry, so not necessarily needing steps 1 and 2.<br>
### Google Container Registry - Build Triggers</p>
<p>You can use build triggers from <a href="https://cloud.google.com/container-registry/">Google Container Registry</a> to build the docker image.</p>
<p>This is typically done by pushing up to a GitHub repository with your Dockerfile, which <a href="https://cloud.google.com/container-builder/docs/concepts/creating-build-triggers">triggers a build</a>. You can then call this docker image directly using <code>gce_shiny_addapp</code>.</p>
<div id="create-a-dockerfile-in-build-folder-including-copying-the-shiny-app-into-the-docker-image" class="section level2">
<h2 class="hasAnchor">
<a href="#create-a-dockerfile-in-build-folder-including-copying-the-shiny-app-into-the-docker-image" class="anchor"></a>Create a Dockerfile in build folder, including copying the Shiny app into the Docker image</h2>
<p>The <code>Dockerfile</code> also includes a <code>COPY</code> command to copy necessary Shiny <code>ui.R</code> and <code>server.R</code> files into the Docker image.</p>
<p>The Shiny app used is the <a href="https://mark.shinyapps.io/googleAuthRexample/"><code>googleAuthR</code> demo app</a>, and the build directory can be found via: <code><a href="../reference/get_dockerfolder.html">get_dockerfolder("shiny-googleAuthRdemo")</a></code></p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash"><span class="kw">FROM</span> rocker/shiny
<span class="kw">MAINTAINER</span> Mark Edmondson (r@sunholo.com)

<span class="co"># install R package dependencies</span>
<span class="kw">RUN</span> apt-get update <span class="kw">&amp;&amp;</span> <span class="kw">apt-get</span> install -y \
    libssl-dev \
    <span class="co">## clean up</span>
    <span class="kw">&amp;&amp;</span> <span class="kw">apt-get</span> clean <span class="dt">\ </span>
    <span class="kw">&amp;&amp;</span> <span class="kw">rm</span> -rf /var/lib/apt/lists/ <span class="dt">\ </span>
    <span class="kw">&amp;&amp;</span> <span class="kw">rm</span> -rf /tmp/downloaded_packages/ /tmp/*.rds
    
<span class="co">## Install packages from CRAN</span>
<span class="kw">RUN</span> install2.r --error <span class="dt">\ </span>
    <span class="kw">-r</span> <span class="st">'http://cran.rstudio.com'</span> \
    googleAuthR \
    <span class="co">## clean up</span>
    <span class="kw">&amp;&amp;</span> <span class="kw">rm</span> -rf /tmp/downloaded_packages/ /tmp/*.rds

<span class="co">## assume shiny app is in build folder /shiny</span>
<span class="kw">COPY</span> ./shiny/ /srv/shiny-server/myapp/</code></pre></div>
<p>Note the <code>COPY</code> command at the end - this copies from a folder in the same location as the <code>Dockerfile</code>. and then places it in the <code>/srv/shiny-server/</code> folder which is the default location for Shiny apps - this location means that the Shiny app will be avialable at <code>your.ip.addr.ess/myapp/</code></p>
<p>We also install <code>googleAuthR</code> from CRAN, and a Debian dependency for <code>googleAuthR</code> that is needed, <code>libssl-dev</code> via <code>apt-get</code>.</p>
<div id="create-your-shiny-app-and-place-in-subfolder-of-your-build-folder" class="section level3">
<h3 class="hasAnchor">
<a href="#create-your-shiny-app-and-place-in-subfolder-of-your-build-folder" class="anchor"></a>Create your Shiny app and place in subfolder of your build folder</h3>
<p>Create your Shiny app as normal, then place into a folder with this structure:</p>
<pre><code>|
|- /appname/
   |
   |- ui.R
   |- server.R
| Dockerfile
</code></pre>
<p>The file structure for the build is then:</p>
<pre><code>list.files(get_dockerfolder("shiny-googleAuthRdemo"), recursive = TRUE)
# "Dockerfile"        "shiny/DESCRIPTION" "shiny/readme.md"   "shiny/server.R"    "shiny/ui.R"</code></pre>
</div>
</div>
<div id="build-your-shiny-app-docker-image" class="section level2">
<h2 class="hasAnchor">
<a href="#build-your-shiny-app-docker-image" class="anchor"></a>Build your Shiny app Docker image</h2>
<p>Build the image by pushing up to a GitHub repo with a set up <a href="https://cloud.google.com/container-builder/docs/concepts/creating-build-triggers">build trigger</a>, or you can build locally or within a custom GCE image using <code>docker_build</code>.</p>
<p>This may take 10mins or so, espeically if its the first layer of the image.</p>
</div>
<div id="start-up-a-shiny-templated-google-compute-engine-vm-with-your-custom-image" class="section level2">
<h2 class="hasAnchor">
<a href="#start-up-a-shiny-templated-google-compute-engine-vm-with-your-custom-image" class="anchor"></a>Start up a Shiny templated Google Compute Engine VM with your custom image</h2>
<p>Start up a Shiny templated image, which makes sure the right ports are open etc. We also add the <code>dynamic_image</code> argument pointing at the Docker image you have built in previous step.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## make new Shiny template VM for your self-contained Shiny app
vm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gce_vm.html">gce_vm</a></span>(<span class="st">"myapp"</span>, 
             <span class="dt">template =</span> <span class="st">"shiny"</span>,
             <span class="dt">predefined_type =</span> <span class="st">"n1-standard-2"</span>,
             <span class="dt">dynamic_image =</span> <span class="kw"><a href="../reference/gce_tag_container.html">gce_tag_container</a></span>(<span class="st">"custom-shiny-app"</span>, <span class="st">"your-project"</span>))</code></pre></div>
<div id="re-deploy-already-built-shiny-app-to-another-vm" class="section level3">
<h3 class="hasAnchor">
<a href="#re-deploy-already-built-shiny-app-to-another-vm" class="anchor"></a>Re-deploy already built Shiny app to another VM</h3>
<p>Now you have a built app, you can deploy it to other instances simply by specifying the build shiny image. If using the recommended Build trigger method, you can specify development or production folders in your GitHub repository. You will need to restart a Shiny VM to load the latest build.</p>
</div>
</div>
<div id="tidy-up" class="section level2">
<h2 class="hasAnchor">
<a href="#tidy-up" class="anchor"></a>Tidy up</h2>
<p>Clean up the VMs to avoid unnecessary costs:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># delete build VM</span>
<span class="kw"><a href="../reference/gce_vm_delete.html">gce_vm_delete</a></span>(vm)</code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#self-contained-shiny-app">Self-contained Shiny app</a><ul class="nav nav-pills nav-stacked">
<li><a href="#create-a-dockerfile-in-build-folder-including-copying-the-shiny-app-into-the-docker-image">Create a Dockerfile in build folder, including copying the Shiny app into the Docker image</a></li>
      <li><a href="#build-your-shiny-app-docker-image">Build your Shiny app Docker image</a></li>
      <li><a href="#start-up-a-shiny-templated-google-compute-engine-vm-with-your-custom-image">Start up a Shiny templated Google Compute Engine VM with your custom image</a></li>
      <li><a href="#tidy-up">Tidy up</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Mark Edmondson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
